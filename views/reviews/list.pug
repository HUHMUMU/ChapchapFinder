extends ../layout
block content
    h2.my-4 리뷰 관리
    h4.my-4 #{store.store_name}
    div
        div.border.border-2.border-dark.my-4.rounded-3
            div.d-flex.justify-content-between
                - const starAvg = Math.round((reviews.reduce((acc, review) => acc + review.star, 0) / reviews.length) * 10) / 10
                h1.my-4.text-start 별점 평균: #{starAvg.toFixed(1)}
                div.my-4(style="width: 50%")
                - const totalReviews = reviews.length
                - const stars = [0, 0, 0, 0, 0]
                each review in reviews
                    - if (review.star >= 1 && review.star <= 5)
                    - stars[review.star - 1]++

                div.progress
                    each star, index in stars
                        - const percentage = totalReviews > 0 ? Math.round(star / totalReviews * 100 * 10) / 10 : 0
                        div.progress-bar(
                            role='progressbar'
                            aria-valuenow=percentage
                            aria-valuemin='0'
                            aria-valuemax='100'
                            style=`width: ${percentage}%;`
                        )
                            | #{index + 1} star: #{percentage}%

        form.mx-auto.mt-4.mb-2(method="GET", action="/boards/list.do",style="width:400px")
            input(type="hidden",value=params.field,name="field")
            input(type="hidden",value=params.value,name="value")
            div.d-flex.justify-content-between.my-4.input-group(style="width: 100%")
                div.border.border-2.border-dark.text-center(style="width: 50%")
                    h4 전체 리뷰 (#{count})
                div.border.border-2.border-dark.text-center(style="width: 50%")
                    h4 미답변 리뷰 (#{uncount})
        div.container.my-4
            each review in reviews
                -const firstReply = review.reviewRepliesEntities[0];
                    div.row.border.border-2.border-dark.rounded-3.mt-3
                        div.col-2
                            h3.my-2.text-start #{review.user_id}
                            h5.my-2.text-start 등급
                            div.star-ratings
                                div.star-ratings
                                    - const stars = '★'.repeat(review.star)
                                    p #{stars}
                        div.col-8
                            p.mt-2 리뷰 작성 날짜 #{review.date}
                            h4.mt-4 리뷰내용
                            p.mt-2 #{review.content}
                            p.my-4 메뉴 한줄평: #{review.comment}
                            div.my-4 메뉴 사진 #{review.img}
                            p.my-4 주문메뉴:
                        div.col-2.d-flex.flex-column.align-items-start.justify-content-between
                            div
                                button.btn.btn-outline-secondary.my-4(type="button") 신고하기
                            -if(firstReply==null)
                                div.text-end.mb-3
                                    div.modal.fade(aria-hidden="true", aria-labelledby="insertModalToggle", tabindex="-1" id=`insertModalToggle${review.review_num}`)
                                        div.modal-dialog.modal-dialog-centered.modal-lg.modal-dialog-scrollable
                                            div.modal-content
                                                div.modal-header
                                                    h1.modal-title.fs-5#insertModalToggle #{review.user_id}님에 대한 리뷰답글
                                                    button.btn-close(data-bs-dismiss="modal", aria-label="Close")
                                                div.modal-body
                                                    textarea.form-control(style={
                                                        width: "100%",
                                                        height: "200px"
                                                    }, name="reply_content")
                                                div.modal-footer
                                                    button.btn.btn-primary(type="button") 등록하기
                                    a.btn.btn-primary(data-bs-toggle="modal", href=`#insertModalToggle${review.review_num}`, role="button") 등록하기
                    -if(firstReply!=null)
                        -const replyContent = firstReply.content;
                        -const replyPostdate = firstReply.post_date;
                        if(`${replyContent}`)
                        include ../replies/list
